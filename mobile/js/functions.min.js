$(function(){function e(){localStorage.removeItem("stage1"),localStorage.removeItem("stage2"),localStorage.removeItem("stage3")}var t=$("#snsMore");$(".forehead .btn-sns-more").on("click",function(){return t.toggleClass("open"),!1}),$("#snsMore .close-modal").on("click",function(){return t.removeClass("open"),o.removeClass("open"),!1});var n=$("meta[property='og:url']").attr("content"),o=$("#popup_wechat");$("#snsMore .sns-wc").on("click",function(){o.addClass("open");var e=$("#qrcode").width();return $("#qrcode").empty().qrcode({width:e,height:e,text:n}),!1}),$("body").on("mousewheel",function(){event.preventDefault();var e=event.wheelDelta,t=window.pageYOffset;window.scrollTo(0,t-e)}),$(".lazy").lazyload({effect:"fadeIn"});var a=$("#roof").outerHeight(),r=($(window).height(),$("#viewport").innerWidth(),$("#viewport").attr("class")),s=new ScrollMagic.Controller;!function(){Date.prototype.yyyymmdd=function(){var e=this.getFullYear().toString(),t=(this.getMonth()+1).toString(),n=this.getDate().toString();return this.getHours().toString(),this.getMinutes().toString(),this.getSeconds().toString(),e+(t[1]?t:"0"+t[0])+(n[1]?n:"0"+n[0])},(new Date).yyyymmdd()}();var a=$("#roof").outerHeight(),s=($(window).height(),new ScrollMagic.Controller);$("#hiddenvideo").fnSetVideo({ovpUrl:"http://v.ovp.joins.com/ExXst2VK",ovpRo:1,ctrls:!0,loop:!1,auto:!0,preload:"none",poster:"/project/NCSOFT/img/hiddenstage_poster.jpg"}),function(){var t=localStorage.getItem("stage1"),n=localStorage.getItem("stage2"),o=localStorage.getItem("stage3");if("complete"==t&&"complete"==n&&"complete"==o){TweenMax.set(".onhiddenstage",{display:"block",zIndex:32}),TweenMax.to(".btn_nav_open",.1,{display:"none"});var a=document.getElementById("introPlay"),i=document.getElementById("introPlayLink");if(null!=a){var r=new TimelineMax({paused:!0}).to(a,.6,{opacity:"0"}).to(a,0,{display:"none"}).to(".onhiddenstage",1,{display:"none",opacity:0}).to("#introe",1,{display:"block"}).to("#introTitle",1,{display:"block"}).to("#intro_progress",1,{display:"block"});$(".close_video").click(function(){TweenMax.to(".onhiddenstage",.5,{display:"none",opacity:0}),TweenMax.to(".btn_nav_open",.6,{display:"block"})}),setTimeout(function(){console.log("show hiddenstage"),console.log("remove localstorage"),e()},5e3),i.addEventListener("click",function(t){t.preventDefault(),e(),r.restart()})}}else TweenMax.set(".onhiddenstage",{display:"none"})}();var l=new TimelineMax({paused:!0}).to("#stageNav",.4,{y:"100%"}).to(".btn_nav_open i",.4,{scale:0},0).to(".btn_nav_open",.2,{autoAlpha:0}).to("#allStageNav",.6,{autoAlpha:1,zIndex:110,height:"calc(100vh - 50px)",top:"50px"});l.eventCallback("onReverseComplete",function(){$(".menu_ctrl.close").click()}),$(".menus a").on("click",function(e){e.preventDefault();var t=$(this).attr("href");r==t.split("#")[0]?location.href="#"+t.split("#")[1]:(location.href=t,l.reverse())}),$(".btn_nav_open, #stageNav .label").not(".label.sns").on("click",function(e){if(e.preventDefault(),$(this).parent().hasClass("nav_hidden")){var t=localStorage.getItem("stage1"),n=localStorage.getItem("stage2"),o=localStorage.getItem("stage3");t&&n&&o?location.href="index.html":alert("모든 컨텐츠를 다 감상하시면 열립니다")}else l.restart()}),$(".btn_nav_close").on("click",function(e){e.preventDefault(),l.reverse()}),TweenMax.set("ol.menus",{display:"none"}),$(".menu_ctrl").click(function(e){e.preventDefault();var t=$(this).closest(".stage_nav_container");$(this).hasClass("open")?(TweenMax.set(t.find(".menus"),{display:"block"}),TweenMax.set($(this),{className:"menu_ctrl close",overwrite:"none"}),TweenMax.set($(".stage_nav_container").not(t),{display:"none"}),TweenMax.set(t,{height:"100%"}),TweenMax.from(t,.4,{opacity:"0"}),TweenMax.from(t.find(".nav_inner"),.6,{top:"-50px"})):(TweenMax.set(t.find(".menus"),{display:"none"}),TweenMax.set($(this),{className:"menu_ctrl open",overwrite:"none"}),TweenMax.set($(".stage_nav_container"),{height:"",display:""}))});var c=[],g=$(".section_wrap").length;for(i=0;i<g;i++)c.push("<b><i></i></b>");$("#stageNav .bar").append(c.join("")),$(window).load(function(){$(".section_wrap").each(function(){function e(){$("#stageNav .bar b:eq("+t+")").addClass("on"),$("#stageNav .num").text(t+1+"/"+g),t+1==g&&localStorage.setItem(r,"complete")}var t=$(".section_wrap").index(this);new ScrollMagic.Scene({triggerElement:this,triggerHook:1,offset:-a,duration:$(this).height()}).addTo(s).reverse(!1).on("enter leave progress",function(n){"enter"==n.type&&(TweenMax.set("#stageNav .bar b:eq("+t+") i",{backgroundColor:"#fff"}),TweenMax.to("#stageNav .bar b:eq("+t+") i",.4,{backgroundColor:"#fff",opacity:0,repeat:-1,yoyo:!0})),"progress"==n.type&&100==Math.floor(100*n.progress)&&TweenMax.to("#stageNav .bar b:eq("+t+") i",.3,{opacity:1,backgroundColor:"#d8b17e",clearProps:"all",onComplete:e})})}),$(".section_wrap").each(function(e,t){var n=$(this).eq(0).height();new ScrollMagic.Scene({triggerElement:t,triggerHook:"onCenter",duration:n}).setClassToggle(t,"active_section").addTo(s)})}),($("#nav").hasClass("at_stage1")||$("#nav").hasClass("at_stage2")||$("#nav").hasClass("at_stage3"))&&(TweenMax.set("#nav",{top:$(".section_parent").offset().top}),new ScrollMagic.Scene({triggerElement:".section_parent",triggerHook:0,offset:-a}).setTween(TweenMax.set("#nav",{top:"calc(100vh - 60px)"})).setTween(TweenMax.set(".sticky_nav",{opacity:1,visibility:"visible"})).setClassToggle(".sticky_nav","active").addTo(s)),$(".onhiddenstage")&&function(){var e=jQuery(window);jQuery(".star_black").each(function(){function t(){c.clearRect(0,0,i,r),c.fillStyle="#fff",c.beginPath();for(var e=0;e<s;e++){var t=p[e];c.moveTo(t.x,t.y),c.arc(t.x,t.y,t.r,0,2*Math.PI,!0)}c.fill(),n()}function n(){for(var e=0;e<s;e++){var t=p[e];t.y+=Math.cos(t.d)+1+t.r/2,t.y>r&&e%3>0&&(p[e]={x:Math.random()*i,y:-10,r:t.r,d:t.d})}}function o(){i=window.innerWidth,r=window.innerHeight,l.width=i,l.height=r,s=.35*i,p=[];for(var e=0;e<s;e++)p.push({x:Math.random()*i,y:Math.random()*r,r:1.5*Math.random(),d:Math.random()*s})}function a(){setTimeout(function(){t(),requestAnimationFrame(a)},1200/g)}var i,r,s,l=this,c=l.getContext("2d"),g=30,p=[];o(),e.on("resize",o),a()})}(),$("#sectionSharebtn").click(function(){var e=$(".shareIcon");e.attr("initH")||e.attr("initH",e.height()),0!=e.height()?(TweenMax.to(e,.2,{height:0,visibility:"hidden",opacity:0,y:30}),$(this).removeClass("close").addClass("open"),console.log("close")):(TweenMax.to(e,.2,{height:e.attr("initH"),visibility:"visible",opacity:1,y:-30}),$(this).removeClass("open").addClass("close"))}),function(){new Swiper(".interviewSwiper",{preloadImages:!1,lazyLoading:!0,slidesPerView:"1",paginationClickable:!0,nextButton:".interview-next",prevButton:".interview-prev",lazyLoadingOnTransitionStart:!0,pagination:".progress_num",paginationClickable:!0,paginationType:"custom",paginationCustomRender:function(e,t,n){return'<span class="current">'+t+'</span><span class="last">'+n+"</span>"}})}(),function(){new Swiper("#pinContainer",{preloadImages:!1,lazyLoading:!0,slidesPerView:"1",paginationClickable:!0,nextButton:".pin-next",prevButton:".pin-prev",lazyLoadingOnTransitionStart:!0,pagination:".progress_pin",paginationClickable:!0,paginationBulletRender:function(e,t,n){return'<span class="'+n+'"></span>'}})}()});